# Cursor Kuralları — FocusGuard Study

[AMAÇ]
- Öğrenciler için dikkat takibi; 3 mod: Kitap, Telefon, Hibrit.
- iOS (ARKit) native bakış hesabı, Flutter UI + Firebase veri.

[GENEL]
- Flutter null-safety, küçük fonksiyonlar, Türkçe yorumlar + İngilizce değişken isimleri.
- Ek bağımlılık: sadece Firebase çekirdeği ve basit grafik kütüphanesi.
- MethodChannel adı: "gaze". start/stop ve onFrame standart.
- (x,y) normalize [0..1], sol-üst (0,0). Flutter piksele çevirir.
- Orientation: İlk sürüm portrait. TODO: landscape.
- Her PR’da README/todo güncel olmalı.

[iOS TARAFI]
- Swift 5+, `ARFaceTrackingConfiguration`, `ARSessionDelegate`.
- `lookAtPoint` veya eye forward vectors → ray-plane → normalize (x,y).
- Her frame tek invoke (onFrame). Gerekirse throttling.
- `NSCameraUsageDescription` Info.plist. Signing otomatik.
- Validity: Yüz kaybında `valid=false`.
- M2: `headEulerAngles.pitch` MethodChannel ile gönder.

[FLUTTER TARAFI]
- GazeFrame: { x, y, conf, ts, valid } (+ M2: headPitch).
- 1-Euro filter parametreleri ayarlanabilir.
- Kalibrasyon: 5–9 nokta, afine fit. Persist et.
- UI: Auth, Home (Ders Çalış), Mod Seçimi, Çalışma, Raporlarım.
- Çalışma ekranı: Sol 3/5 kamera, sağ 2/5 metrikler + butonlar.
- Dikkat kuralı: drifting toplam ≥10s uyar.

[DATA]
- Firestore: `users/{uid}/sessions/{sessionId}`
- Alanlar: startTs, endTs, mode, focusRatio, distractCount, events[]
- Log JSONL opsiyonel. Ham frame verisi cloud’a gönderilmez.

[TEST]
- Gerçek cihazda dene. Simulator’da mock gerekirse basit.
- Dönen verileri manuel doğrula; günlük raporları kontrol et.

[KOD STİLİ]
- Türkçe yorumlar + İngilizce değişken isimleri.
- Hata mesajları açıklayıcı. try/catch ve guard’lar net.
- Büyük fonksiyonları parçala. State sızıntısı yok.

[İSTEMEDİKLERİMİZ]
- Aşırı bağımlılık, gereksiz mimari ağırlık.
- Karmaşık simulator stub’ları.
- Sınıflandırma/gesture (ileride değerlendirilecek).

[LEAD]
- M1: Auth + modlar + temel dikkat + Firestore + raporlar.
